- block:
    - name: "Include vars for {{ distroPretty }}"
      block:
        - include_vars: "user.yaml"
        - include_vars: "{{ distro }}.yaml"
      tags: ["always", "vars"]
      when: isUbuntu or isFedora

    - import_tasks: "system/fonts/firacode.yaml"
    - import_tasks: "system/fonts/inconsolata.yaml"
    - import_tasks: "system/fonts/mscorefonts.yaml"
    - import_tasks: "system/fonts/plex.yaml"
    - import_tasks: "system/fonts/sourcecodepro.yaml"
    - import_tasks: "system/terminal.yaml"

    - name: "Include common tasks for {{ distroPretty }}"
      import_tasks: "distro/common.yaml"
      tags: ["distro_tasks"]
      when: isFedora or isUbuntu

    - name: "Include tasks for {{ distroPretty }}"
      import_tasks: "distro/ubuntu.yaml"
      tags: ["distro_tasks"]
      when: isUbuntu

    - name: "Include tasks for Gnome"
      block:
        - include_tasks: "shared/desktop/gnome.yaml"
        - import_tasks: "desktop/gnome.yaml"
      tags: ["gnome"]
      vars:
        profileUsername: "{{ userUsername }}"

    - import_tasks: "software/virtualbox.yaml"

    - name: "User settings"
      block:
        - import_tasks: "shared/users/git.yaml"
        - import_tasks: "shared/users/gtk.yaml"
        - import_tasks: "shared/users/home_folder.yaml"
        - import_tasks: "shared/users/nautilus.yaml"
        - import_tasks: "shared/users/profile.yaml"
        - import_tasks: "shared/users/terminal.yaml"
        - include_tasks: "users/freefilesync.yaml"
        - include_tasks: "users/home_folder.yaml"
        - include_tasks: "users/obsidian.yaml"
        - include_tasks: "users/profile.yaml"
        - include_tasks: "users/terminal.yaml"
      tags: ["stephen"]
      vars:
        profileUsername: "{{ userUsername }}"
        profileFullname: "{{ userFullname }}"

    - name: "Install dev tools"
      block:
        - import_tasks: "shared/system/tools/nvm.yaml"
        - import_tasks: "shared/system/tools/pnpm.yaml"
        - import_tasks: "shared/system/tools/vsce.yaml"
        - import_tasks: "shared/system/tools/yarn.yaml"
        - import_tasks: "shared/system/tools/yeoman.yaml"
      tags: ["stephen"]
      vars:
        profileUsername: "{{ userUsername }}"
      when: installDevTools

  rescue:
    - set_fact: stephen_task_failed=true
  when: users.stephen
