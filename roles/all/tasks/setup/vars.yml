# Assign needed vars to facts so that fact gathering can be disabled for real/virtual

- name: 'Set distro'
  set_fact:
      distro: '{{ ansible_distribution | lower }}'
  tags: ['set_fact']

- name: 'Set distro_major_version'
  set_fact:
      distro_major_version: '{{ ansible_distribution_major_version }}'
  tags: ['set_fact']

- name: 'Set is_gnome'
  set_fact:
      is_gnome: '{{ ("gnome" in (ansible_facts["env"]["XDG_CURRENT_DESKTOP"] | lower)) | ternary (true, false) }}'
  tags: ['set_fact']

- name: 'Set is_kde'
  set_fact:
      is_kde: '{{ ("kde" in (ansible_facts["env"]["XDG_CURRENT_DESKTOP"] | lower)) | ternary (true, false) }}'
  tags: ['set_fact']

- name: 'Set is_virtual'
  set_fact:
      is_virtual: '{{ (ansible_virtualization_role == "guest") | ternary (true, false) }}'
  tags: ['set_fact']

- name: 'Set is_virtualbox'
  set_fact:
      is_virtualbox: '{{ (ansible_virtualization_type == "virtualbox") | ternary (true, false) }}'
  tags: ['set_fact']

- name: 'Set real_username'
  set_fact:
      real_username: '{{ansible_facts["env"]["SUDO_USER"]}}'
  tags: ['set_fact']

- name: 'Facts collected for other roles'
  ansible.builtin.debug:
    msg:
      - 'distro: {{distro}}'
      - 'distro_major_version: {{distro_major_version}}'
      - 'is_gnome: {{is_gnome}}'
      - 'is_kde: {{is_kde}}'
      - 'is_virtual: {{is_virtual}}'
      - 'is_virtualbox: {{is_virtual}}'
      - 'real_username: {{real_username}}'
  tags: ['debug']