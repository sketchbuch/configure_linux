# Assign needed vars to facts so that fact gathering can be disabled for real/virtual

- name: 'Setup > Vars: Set distro'
  set_fact:
      distro: '{{ ansible_distribution | lower }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set distro_pretty'
  set_fact:
      distro_pretty: '{{ distro | capitalize }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set distro_major_version'
  set_fact:
      distro_major_version: '{{ ansible_distribution_major_version }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_fedora'
  set_fact:
      is_fedora: '{{ distro == 'fedora' | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_gnome'
  set_fact:
      is_gnome: '{{ ("gnome" in (ansible_facts["env"]["XDG_CURRENT_DESKTOP"] | lower)) | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_kde'
  set_fact:
      is_kde: '{{ ("kde" in (ansible_facts["env"]["XDG_CURRENT_DESKTOP"] | lower)) | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_ubuntu'
  set_fact:
      is_ubuntu: '{{ distro == 'ubuntu' | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_virtual'
  set_fact:
      is_virtual: '{{ (ansible_virtualization_role == "guest") | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set is_virtualbox'
  set_fact:
      is_virtualbox: '{{ (ansible_virtualization_type == "virtualbox") | ternary (true, false) }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set real_username'
  set_fact:
      real_username: '{{ ansible_facts["env"]["SUDO_USER"] }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Set real_username_pretty'
  set_fact:
      real_username_pretty: '{{ real_username | capitalize }}'
  tags: ['setup', 'set_fact']

- name: 'Setup > Vars: Facts collected for other roles'
  ansible.builtin.debug:
    msg:
      - 'distro: {{ distro }}'
      - 'distro_pretty: {{ distro_pretty }}'
      - 'distro_major_version: {{ distro_major_version }}'
      - 'is_fedora: {{ is_fedora }}'
      - 'is_gnome: {{ is_gnome }}'
      - 'is_kde: {{ is_kde }}'
      - 'is_ubuntu: {{ is_ubuntu }}'
      - 'is_virtual: {{ is_virtual }}'
      - 'is_virtualbox: {{ is_virtual }}'
      - 'real_username: {{ real_username }}'
      - 'real_username_pretty: {{ real_username_pretty }}'
  tags: ['setup', 'debug']