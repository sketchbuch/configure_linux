- name: 'System > Tools > NVM: Install'
  become: true
  become_user: '{{ real_username }}'
  ansible.builtin.shell:
    cmd: curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
    creates: '/home/{{ real_username }}/.nvm/nvm.sh'
  tags: ['system', 'dev']

- name: 'System > Tools > NVM: Install node versions'
  become: true
  become_user: '{{ real_username }}'
  ansible.builtin.shell: >
    /bin/bash -c "source ~/.nvm/nvm.sh && nvm install {{ item }}"
  tags: ['system', 'dev']
  with_items:
    - '16.13.0'
    - '16.15.1'
    - '18.4.0'

- name: 'System > Tools > NVM: Set default node version'
  become: true
  become_user: '{{ real_username }}'
  ansible.builtin.shell: >
    /bin/bash -c "source ~/.nvm/nvm.sh && nvm alias default 16.13.0"
  tags: ['system', 'dev']
  creates: '/home/{{ real_username }}/.nvm/alias'