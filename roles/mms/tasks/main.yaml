- block:
  - name: 'Include vars for {{ distro_pretty }}'
    include_vars: '{{ distro }}.yaml'
    tags: ['always', 'vars']

  # - name: 'Include tasks for {{ distro_pretty }}'
  #   import_tasks: 'distro/ubuntu.yaml'
  #   tags: ['distro_tasks']
  #   when: is_ubuntu
  
  # - name: 'Include tasks for Gnome'
  #   import_tasks: 'desktop/gnome.yaml'
  #   tags: ['gnome']
  #   when: is_gnome
  
  - import_tasks: 'users/create.yaml'

  - name: 'User settings'
    block:
      - import_tasks: 'shared/users/git.yaml'
      - import_tasks: 'shared/users/gtk.yaml'
      - import_tasks: 'shared/users/home_folder.yaml'
      - import_tasks: 'shared/users/terminal.yaml'

      - import_tasks: 'shared/users/profile.yaml'
    tags: ['mms']
    vars:
      profile_username: '{{ mmsUsername }}'
      profile_username_pretty: '{{ mmsFullname }}'
    
  - import_tasks: 'users/mms/home_folder.yaml'

  - name: 'Install tools'
    block:
      - import_tasks: 'shared/system/tools/nvm.yaml'
      - import_tasks: 'shared/system/tools/pnpm.yaml'
      - import_tasks: 'shared/system/tools/yarn.yaml'
    vars:
      profile_username: '{{ mmsUsername }}'
    tags: ['mms']

  rescue:
    - set_fact: mms_task_failed=true
  when: users.mms