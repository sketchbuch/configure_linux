- block:
  - name: 'MMS'
    ansible.builtin.debug:
      msg: "Doing MMS"
    tags: ['setup', 'debug']

  - name: 'Include vars for {{ distro_pretty }}'
    include_vars: '{{ distro }}.yaml'
    tags: ['always', 'vars']

  # - name: 'Include tasks for {{ distro_pretty }}'
  #   import_tasks: 'distro/ubuntu.yaml'
  #   tags: ['distro_tasks']
  #   when: is_ubuntu
  
  # - name: 'Include tasks for Gnome'
  #   import_tasks: 'desktop/gnome.yaml'
  #   tags: ['gnome']
  #   when: is_gnome
  
  - import_tasks: 'users/create.yaml'
  - import_tasks: 'shared/users/profile_image.yaml'
    tags: ['mms']
    vars:
      profile_username: '{{ mmsUsername }}'
      profile_username_pretty: '{{ mmsFullname }}'

  rescue:
    - set_fact: mms_task_failed=true
  when: users.mms