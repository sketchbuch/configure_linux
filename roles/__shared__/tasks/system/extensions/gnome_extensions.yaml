- name: 'System > Extensions > Gnome Extensions: "{{ extension.name }}" - Check if is already installed'
  ansible.builtin.stat:
    path: "/home/{{ profile_username }}/.local/share/gnome-shell/extensions/{{ extension.uuid }}"
  become: true
  become_user: "{{ profile_username }}"
  register: gnome_extension_check
  tags: ["system", "desktop", "gnome", "extensions", "files"]

- name: 'System > Extensions > Gnome Extensions: "{{ extension.name }}" - Exists'
  ansible.builtin.debug:
    msg: "Skipping install"
  become: true
  become_user: "{{ profile_username }}"
  tags: ["system", "desktop", "gnome", "extensions"]
  when: gnome_extension_check.stat.exists

- name: "{{ extension.name }}:"
  become: true
  become_user: "{{ profile_username }}"
  block:
    - name: 'System > Extensions > Gnome Extensions: "{{ extension.name }}" - Download'
      ansible.builtin.get_url:
        dest: "{{ anisbleTmp }}/gnome_extensions/{{ extension.uuid }}.zip"
        url: "https://extensions.gnome.org/extension-data/{{ extension.url }}"

    # enable command does not work, so manual enabling is still required
    - name: 'System > Extensions > Gnome Extensions: "{{ extension.name }}" - Install'
      ansible.builtin.command:
        cmd: 'gnome-extensions install "{{ anisbleTmp }}/gnome_extensions/{{ extension.uuid }}.zip"'
  tags: ["system", "desktop", "gnome", "extensions"]
  when: not gnome_extension_check.stat.exists
